import"./modulepreload-polyfill-B5Qt9EMX.js";import{S as G}from"./config-DgteQrrW.js";let p="",s=1;function Y(c){document.readyState==="loading"?document.addEventListener("DOMContentLoaded",c,{once:!0}):c()}async function ee(){try{const c=await fetch("/api/csrf-token");if(!c.ok)throw new Error("Failed to get token CSRF.");p=(await c.json()).csrfToken,console.log("CSRF Token obtenido:",p),te()}catch(c){console.error("Error getting token CSRF:",c),document.body.classList.add("loading"),alert("The application could not be loaded. Please try again later.")}}function te(){Y(()=>{const c=document.getElementById("bookingForm"),y=document.querySelectorAll(".booking-step"),Q=document.querySelectorAll("[data-step]"),w=document.querySelector("#wizard-nav-buttons [data-next]");document.getElementById("wizard-nav-buttons");const E=document.querySelector('select[name="cPay"]'),g=document.getElementById("stripe-payment-form"),a=document.getElementById("submit-payment"),d=document.getElementById("termsCheck"),A=document.getElementById("payment-message"),P=document.querySelector('input[name="bDate"]'),B=document.getElementById("quickQuoteForm"),F=document.getElementById("estPrice");document.querySelectorAll("form button[data-prev], form button[data-next]").forEach(e=>{e.hasAttribute("type")||e.setAttribute("type","button")});const C=document.querySelectorAll("[data-view]"),j=document.querySelectorAll("[data-link]"),v=e=>{e&&(C.forEach(t=>{t.classList.toggle("active",t.id===e)}),j.forEach(t=>{const o=(t.getAttribute("href")||"").replace(/^#/,"")===e;t.classList.toggle("active",o)}),location.hash!==`#${e}`&&history.pushState({view:e},"",`#${e}`))},N=(location.hash||"").replace(/^#/,"")||C[0]&&C[0].id||null;N&&v(N),window.addEventListener("popstate",()=>{const e=(location.hash||"").replace(/^#/,"");e&&v(e)}),document.body.addEventListener("click",e=>{const t=e.target.closest("[data-link]");if(!t)return;const n=t.getAttribute("href")||"";if(!n.startsWith("#"))return;e.preventDefault();const o=n.substring(1);v(o)});function z(){Q.forEach(e=>{const t=Number(e.getAttribute("data-booking-step")||"0");e.classList.toggle("active",t===s),e.classList.toggle("completed",t<s)})}function l(e){return e<1||e>y.length?!1:(y.forEach((t,n)=>{t.classList.toggle("d-none",n+1!==e)}),s=e,z(),w&&(e===y.length?w.textContent="Confirm and Pay":w.textContent="Following"),!0)}document.querySelectorAll("[data-next]").forEach(e=>{e.addEventListener("click",async t=>{t.preventDefault(),L(s)&&(s<y.length?l(s+1):E?.value==="card"?a?.click():await X())})}),document.querySelectorAll("[data-prev]").forEach(e=>{e.addEventListener("click",t=>{t.preventDefault(),s>1&&l(s-1)})});function L(e){const t=document.querySelector(`[data-booking-step="${e}"]`);if(!t)return!0;const n=t.querySelectorAll("input, select, textarea");for(const o of n)if(!o.checkValidity())return o.reportValidity(),!1;return!0}const T=document.querySelectorAll("[data-service]");T.length&&T.forEach(e=>{e.addEventListener("click",()=>{T.forEach(o=>o.classList.remove("selected")),e.classList.add("selected");const t=e.getAttribute("data-service"),n=document.querySelector('input[name="bService"]');n&&(n.value=t),l(2),u()})}),l(s),u();const R=Stripe(G);let b=null,I=null,S=null,k=null,q=null;const m=e=>{A&&(A.textContent=e||"")},h=()=>m("");function $(e,t="USD",n=navigator.language){if(e==null||isNaN(e))return"—";const o=e/100;try{return new Intl.NumberFormat(n,{style:"currency",currency:t}).format(o)}catch{return`${o} ${t}`}}function U(){let e,t,n,o,r;const i=document.getElementById("booking");if(i&&i.classList.contains("active")){const f=document.querySelector("[data-service].selected");e=f?f.getAttribute("data-service"):null,t=Number(document.querySelector('[data-booking-step="2"] input[name="bBeds"]')?.value||"0"),n=Number(document.querySelector('[data-booking-step="2"] input[name="bBaths"]')?.value||"1"),o=document.querySelector('[data-booking-step="2"] select[name="bFreq"]')?.value||"Once",r=document.querySelector('[data-booking-step="3"] input[name="bZip"]')?.value||"0000"}else e=document.querySelector('#quickQuoteForm select[name="service"]')?.value||null,t=Number(document.querySelector('#quickQuoteForm input[name="bBeds"]')?.value||"0"),n=Number(document.querySelector('#quickQuoteForm input[name="bBaths"]')?.value||"1"),o=document.querySelector('#quickQuoteForm select[name="bFreq"]')?.value||"Once",r=document.querySelector('#quickQuoteForm input[name="zip"]')?.value||"";const x=Array.from(document.querySelectorAll('[data-booking-step="2"] input[type="checkbox"]:checked')).map(f=>f.value);return e?{serviceCode:e,beds:t,baths:n,freq:o,extras:x,zip:r}:(console.log("Incomplete quote data: missing serviceCode."),null)}function V(){const e=document.querySelector("[data-service].selected");return e&&e.getAttribute("data-service")||null}function W(){return Array.from(document.querySelectorAll('[data-booking-step="2"] input[type="checkbox"]:checked')).map(e=>e.value)}function J(e,t){F&&(F.textContent=$(e,t||"USD"))}function D(){const e=V(),t=Number(document.querySelector('input[name="bBeds"]')?.value||""),n=Number(document.querySelector('input[name="bBaths"]')?.value||"1"),o=(document.querySelector('select[name="bFreq"]')?.value||"Once").trim(),r=W(),i=(document.querySelector('input[name="bDate"]')?.value||"").trim(),x=(document.querySelector('input[name="bTime"]')?.value||"").trim(),f=(document.querySelector('input[name="bAddress"]')?.value||"").trim(),Z=(document.querySelector('input[name="bZip"]')?.value||"").trim(),_=(document.querySelector('input[name="cName"]')?.value||"").trim(),H=(document.querySelector('input[name="cEmail"]')?.value||"").trim(),K=(document.querySelector('input[name="cPhone"]')?.value||"").trim();return{serviceCode:e,beds:t,baths:n,freq:o,extras:r,date:i,time:x,address:f,zip:Z,customer:{name:_,email:H,phone:K}}}let O=null;function u(){return clearTimeout(O),new Promise((e,t)=>{O=setTimeout(async()=>{const n=U();if(!n)return console.log("Incomplete quote data, the API call will not be made."),e(null);k&&k.abort(),k=new AbortController;try{h();const o=await fetch("/api/pricing/quote",{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-Token":p},body:JSON.stringify(n),signal:k.signal});if(!o.ok)throw new Error(await o.text()||"Pricing service not available.");const r=await o.json();S=r,J(r.amount,r.currency);const i=document.getElementById("quickQuoteResult");i&&(i.classList.remove("d-none","alert"),i.classList.add("alert-info"),n.serviceCode==="Regular"?n.serviceCode="House Cleaning":n.serviceCode=`${n.serviceCode} Cleaning`,i.innerHTML=`
                <div><strong>Estimated price::</strong> ${$(r.amount,r.currency)}</div>
                <div class="small text-muted">
                  Service: ${n.serviceCode} · Rooms: ${n.beds} · Bathrooms: ${n.baths} · Frequency: ${n.freq}
                  ${n.extras?.length?" · Extras: "+n.extras.join(", "):""}
                  ${n.zip?" · Zip code: "+n.zip:""}
                </div>
              `),e(r)}catch(o){console.error(o),S=null;const r=document.getElementById("quickQuoteResult");r&&(r.classList.remove("d-none","alert-info"),r.classList.add("alert"),r.textContent="The quote could not be calculated. Please check your input."),m("The quote could not be refreshed. Please try again."),t(o)}},250)})}['[data-booking-step="2"] input','[data-booking-step="2"] select','[data-booking-step="2"] input[type="checkbox"]',"[data-service]"].forEach(e=>{document.querySelectorAll(e).forEach(t=>{t.addEventListener("input",u),t.addEventListener("change",u)})}),B&&B.addEventListener("submit",e=>{e.preventDefault(),u()});async function M(){if(!(b&&I))try{a&&(a.disabled=!0),h(),await u();const e=D(),t=await fetch("/api/bookings",{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-Token":p},body:JSON.stringify({...e,quoteId:S?.quoteId||null})});if(!t.ok)throw new Error(await t.text()||"The reservation could not be created.");if(q=(await t.json())?.id,!q)throw new Error("Reservation ID is missing.");const o=await fetch("/api/payments/stripe/create-payment-intent",{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-Token":p},body:JSON.stringify({bookingId:q})});if(!o.ok)throw new Error(await o.text()||"The PaymentIntent could not be created.");const{clientSecret:r}=await o.json();if(!r)throw new Error("The clientSecret is missing.");b=R.elements({clientSecret:r}),I=b.create("payment",{fields:{billingDetails:{address:"never"}}}),I.mount("#payment-element"),a&&(a.disabled=!(d?.checked&&!g?.classList.contains("hidden")))}catch(e){console.error(e),m(e.message||"Error initializing payment."),a&&(a.disabled=!0)}}E&&E.addEventListener("change",async e=>{if(e.target.value==="card"){const t=L(2),n=L(3);if(!t||!n){m("Complete the previous steps before proceeding to payment."),l(t?3:2),g?.classList.add("d-none"),a&&(a.disabled=!0);return}g?.classList.remove("d-none"),await M(),a&&(a.disabled=!d?.checked)}else g?.classList.add("d-none"),h(),a&&(a.disabled=!0)}),d&&a&&d.addEventListener("change",()=>{g?.classList.contains("d-none")||(a.disabled=!d.checked)});async function X(){const e=document.querySelector("#wizard-nav-buttons [data-next]");e&&(e.disabled=!0),h();try{await u();const t=D(),n=await fetch("/api/bookings",{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-Token":p},body:JSON.stringify({...t,quoteId:S?.quoteId||null})});if(!n.ok){const o=await n.text();throw new Error(o||"The reservation could not be created.")}alert("Reservation confirmed! We'll contact you to coordinate payment."),c.reset(),l(1),v("home")}catch(t){m(t.message||"An error occurred while creating the reservation.")}finally{e&&(e.disabled=!1)}}if(a&&a.addEventListener("click",async()=>{if(!b||!d?.checked)return;a.disabled=!0,h();const{error:e}=await R.confirmPayment({elements:b,confirmParams:{return_url:`${window.location.origin}/stripe/return?booking_id=${encodeURIComponent(q)}`}});e&&(m(e.message||"Payment error"),a.disabled=!1)}),P){const e=new Date().toISOString().split("T")[0];P.setAttribute("min",e)}})}ee();
