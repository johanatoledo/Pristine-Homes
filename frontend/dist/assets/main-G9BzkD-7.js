import"./modulepreload-polyfill-B5Qt9EMX.js";import{S as K}from"./config-DgteQrrW.js";let f="",c=1;function G(a){document.readyState==="loading"?document.addEventListener("DOMContentLoaded",a,{once:!0}):a()}async function Y(){try{const a=await fetch("/api/csrf-token");if(!a.ok)throw new Error("Failed to get token CSRF.");f=(await a.json()).csrfToken,console.log("CSRF Token obtenido:",f),ee()}catch(a){console.error("Error getting token CSRF:",a),document.body.classList.add("loading"),alert("The application could not be loaded. Please try again later.")}}function ee(){G(()=>{const a=document.getElementById("bookingForm"),p=document.querySelectorAll(".booking-step"),O=document.querySelectorAll("[data-step]");document.getElementById("wizard-nav-buttons");const E=document.querySelector('select[name="cPay"]'),y=document.getElementById("stripe-payment-form"),r=document.getElementById("submit-payment"),u=document.getElementById("termsCheck"),x=document.getElementById("payment-message"),A=document.querySelector('input[name="bDate"]'),P=document.getElementById("quickQuoteForm"),B=document.getElementById("estPrice");document.querySelectorAll("form button[data-prev], form button[data-next]").forEach(e=>{e.hasAttribute("type")||e.setAttribute("type","button")});const w=document.querySelectorAll("[data-view]"),Q=document.querySelectorAll("[data-link]"),h=e=>{e&&(w.forEach(t=>{t.classList.toggle("active",t.id===e)}),Q.forEach(t=>{const o=(t.getAttribute("href")||"").replace(/^#/,"")===e;t.classList.toggle("active",o)}),location.hash!==`#${e}`&&history.pushState({view:e},"",`#${e}`))},F=(location.hash||"").replace(/^#/,"")||w[0]&&w[0].id||null;F&&h(F),window.addEventListener("popstate",()=>{const e=(location.hash||"").replace(/^#/,"");e&&h(e)}),document.body.addEventListener("click",e=>{const t=e.target.closest("[data-link]");if(!t)return;const n=t.getAttribute("href")||"";if(!n.startsWith("#"))return;e.preventDefault();const o=n.substring(1);h(o)});function j(){O.forEach(e=>{const t=Number(e.getAttribute("data-booking-step")||"0");e.classList.toggle("active",t===c),e.classList.toggle("completed",t<c)})}function s(e){if(e<1||e>p.length)return!1;p.forEach((n,o)=>{n.classList.toggle("d-none",o+1!==e)}),c=e,j();const t=document.querySelector("#wizard-nav-buttons [data-next]");return t&&(e===p.length?t.textContent="Confirm and Pay":t.textContent="Following"),!0}document.querySelectorAll("[data-next]").forEach(e=>{e.addEventListener("click",async t=>{t.preventDefault(),C(c)&&(c<p.length?s(c+1):E?.value==="card"?r?.click():await M())})}),document.querySelectorAll("[data-prev]").forEach(e=>{e.addEventListener("click",t=>{t.preventDefault(),c>1&&s(c-1)})});function C(e){const t=document.querySelector(`[data-booking-step="${e}"]`);if(!t)return!0;const n=t.querySelectorAll("input, select, textarea");for(const o of n)if(!o.checkValidity())return o.reportValidity(),!1;return!0}const L=document.querySelectorAll("[data-service]");L.length&&L.forEach(e=>{e.addEventListener("click",()=>{L.forEach(o=>o.classList.remove("selected")),e.classList.add("selected");const t=e.getAttribute("data-service"),n=document.querySelector('input[name="bService"]');n&&(n.value=t),s(2),l()})}),s(c),l();const N=Stripe(K);let g=null,T=null,v=null,S=null,k=null;const d=e=>{x&&(x.textContent=e||"")},b=()=>d("");function R(e,t="USD",n=navigator.language){if(e==null||isNaN(e))return"—";const o=e/100;try{return new Intl.NumberFormat(n,{style:"currency",currency:t}).format(o)}catch{return`${o} ${t}`}}function z(){let e,t,n,o,i;const q=document.getElementById("booking");if(q&&q.classList.contains("active")){const m=document.querySelector("[data-service].selected");e=m?m.getAttribute("data-service"):null,t=Number(document.querySelector('[data-booking-step="2"] input[name="bBeds"]')?.value||"0"),n=Number(document.querySelector('[data-booking-step="2"] input[name="bBaths"]')?.value||"1"),o=document.querySelector('[data-booking-step="2"] select[name="bFreq"]')?.value||"Once",i=document.querySelector('[data-booking-step="3"] input[name="bZip"]')?.value||"0000"}else e=document.querySelector('#quickQuoteForm select[name="service"]')?.value||null,t=Number(document.querySelector('#quickQuoteForm input[name="bBeds"]')?.value||"0"),n=Number(document.querySelector('#quickQuoteForm input[name="bBaths"]')?.value||"1"),o=document.querySelector('#quickQuoteForm select[name="bFreq"]')?.value||"Once",i=document.querySelector('#quickQuoteForm input[name="zip"]')?.value||"";const I=Array.from(document.querySelectorAll('[data-booking-step="2"] input[type="checkbox"]:checked')).map(m=>m.value);return e?{serviceCode:e,beds:t,baths:n,freq:o,extras:I,zip:i}:(console.log("Incomplete quote data: missing serviceCode."),null)}function U(){const e=document.querySelector("[data-service].selected");return e&&e.getAttribute("data-service")||null}function V(){return Array.from(document.querySelectorAll('[data-booking-step="2"] input[type="checkbox"]:checked')).map(e=>e.value)}function W(e,t){B&&(B.textContent=R(e,t||"USD"))}function $(){const e=U(),t=Number(document.querySelector('input[name="bBeds"]')?.value||""),n=Number(document.querySelector('input[name="bBaths"]')?.value||"1"),o=(document.querySelector('select[name="bFreq"]')?.value||"Once").trim(),i=V(),q=(document.querySelector('input[name="bDate"]')?.value||"").trim(),I=(document.querySelector('input[name="bTime"]')?.value||"").trim(),m=(document.querySelector('input[name="bAddress"]')?.value||"").trim(),X=(document.querySelector('input[name="bZip"]')?.value||"").trim(),Z=(document.querySelector('input[name="cName"]')?.value||"").trim(),_=(document.querySelector('input[name="cEmail"]')?.value||"").trim(),H=(document.querySelector('input[name="cPhone"]')?.value||"").trim();return{serviceCode:e,beds:t,baths:n,freq:o,extras:i,date:q,time:I,address:m,zip:X,customer:{name:Z,email:_,phone:H}}}let D;async function l(){clearTimeout(D),D=setTimeout(async()=>{const e=z();if(!e){console.log("Incomplete quote data, the API call will not be made.");return}S&&S.abort(),S=new AbortController;try{b();const t=await fetch("/api/pricing/quote",{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-Token":f},body:JSON.stringify(e),signal:S.signal});if(!t.ok)throw new Error(await t.text()||"Pricing service not available.");const n=await t.json();v=n,W(n.amount,n.currency);const o=document.getElementById("quickQuoteResult");o&&(o.classList.remove("d-none","alert"),o.classList.add("alert-info"),e.serviceCode==="Regular"?e.serviceCode="House Cleaning":e.serviceCode=`${e.serviceCode} Cleaning`,o.innerHTML=`
              <div><strong>Estimated price::</strong> ${R(n.amount,n.currency)}</div>
              <div class="small text-muted">
                Service: ${e.serviceCode} · Rooms: ${e.beds} · Bathrooms: ${e.baths} · Frequency: ${e.freq}
                ${e.extras?.length?" · Extras: "+e.extras.join(", "):""}
                ${e.zip?" · Zip code: "+e.zip:""}
              </div>
            `)}catch(t){console.error(t),v=null;const n=document.getElementById("quickQuoteResult");n&&(n.classList.remove("d-none","alert-info"),n.classList.add("alert"),n.textContent="The quote could not be calculated. Please check your input."),d("The quote could not be refreshed. Please try again.")}},250)}['[data-booking-step="2"] input','[data-booking-step="2"] select','[data-booking-step="2"] input[type="checkbox"]',"[data-service]"].forEach(e=>{document.querySelectorAll(e).forEach(t=>{t.addEventListener("input",l),t.addEventListener("change",l)})}),P&&P.addEventListener("submit",e=>{e.preventDefault(),l()});async function J(){if(!(g&&T))try{r&&(r.disabled=!0),b(),await l();const e=$(),t=await fetch("/api/bookings",{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-Token":f},body:JSON.stringify({...e,quoteId:v?.quoteId||null})});if(!t.ok)throw new Error(await t.text()||"The reservation could not be created.");if(k=(await t.json())?.id,!k)throw new Error("Reservation ID is missing.");const o=await fetch("/stripe/create-payment-intent",{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-Token":f},body:JSON.stringify({bookingId:k})});if(!o.ok)throw new Error(await o.text()||"The PaymentIntent could not be created.");const{clientSecret:i}=await o.json();if(!i)throw new Error("The clientSecret is missing.");g=N.elements({clientSecret:i}),T=g.create("payment",{fields:{billingDetails:{address:"never"}}}),T.mount("#payment-element"),r&&(r.disabled=!(u?.checked&&!y?.classList.contains("hidden")))}catch(e){console.error(e),d(e.message||"Error initializing payment."),r&&(r.disabled=!0)}}E&&E.addEventListener("change",async e=>{if(e.target.value==="card"){const t=C(2),n=C(3);if(!t||!n){d("Complete the previous steps before proceeding to payment."),s(t?3:2),y?.classList.add("d-none"),r&&(r.disabled=!0);return}y?.classList.remove("d-none"),await J(),r&&(r.disabled=!u?.checked)}else y?.classList.add("d-none"),b(),r&&(r.disabled=!0)}),u&&r&&u.addEventListener("change",()=>{y?.classList.contains("d-none")||(r.disabled=!u.checked)});async function M(){const e=document.querySelector("#wizard-nav-buttons [data-next]");e&&(e.disabled=!0),b();try{await l();const t=$(),n=await fetch("/api/bookings",{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-Token":f},body:JSON.stringify({...t,quoteId:v?.quoteId||null})});if(!n.ok){const o=await n.text();throw new Error(o||"The reservation could not be created.")}alert("Reservation confirmed! We'll contact you to coordinate payment."),a.reset(),s(1),h("home")}catch(t){d(t.message||"An error occurred while creating the reservation.")}finally{e&&(e.disabled=!1)}}if(r&&r.addEventListener("click",async()=>{if(!g||!u?.checked)return;r.disabled=!0,b();const{error:e}=await N.confirmPayment({elements:g,confirmParams:{return_url:`${window.location.origin}/stripe/return?booking_id=${encodeURIComponent(k)}`}});e&&(d(e.message||"Payment error"),r.disabled=!1)}),A){const e=new Date().toISOString().split("T")[0];A.setAttribute("min",e)}})}Y();
